
\begin{tikzpicture}
\draw[fill = palette1, fill opacity = 0.1, palette1] (0,0) -- (2,0) -- (2,3) -- (0,3);
\draw[fill = palette2, fill opacity = 0.1, palette2] (7,0) -- (5,0) -- (5,3) -- (7,3);

\node[palette1, anchor = east] at (2,3.2) {\scriptsize Kernel};
\node[palette2, anchor = west] at (5,3.2) {\scriptsize Espacio de usuario};

\foreach \x in {0,1,...,3}
	\node[rectangle, draw, black, fill = white] (RX\x) at (1.3, {2.5 - \x * 0.65}) {\scriptsize Rx \x};

\fill[gray, opacity = 0.3] (1.5, -1) rectangle (3, -0.7);
\draw (1.5, -1) rectangle (5.5, -0.7);

\draw[dotted, thick] (3, -0.58) -- (3, -1.12) node[below] (A) {};
\draw[thick] (3.8, -0.58) node[above] (B1) {} -- (3.8, -1.12) node[below ] (B) {};

\draw[thick, palette1, ->] (A.center) -- node[midway, below] {\scriptsize 1. Reserva} (B.center);

\draw[thick, palette1, shorten <= 0.1cm, ->] (RX3) to[bend left] node[midway, above, sloped] {\scriptsize 2. Copia} (3.3, -0.58);

\node[rectangle, draw, black, fill = white] (Lector) at (5.7, 0.4) {\scriptsize Lector};

\draw[thick, palette2, ->, shorten >= 0.1cm, shorten <= 0.1cm]  (2, 1.5) to[bend left] node[midway, sloped, fill = mBackground] {\dots}  node[midway, above, yshift = 0.1cm] {\scriptsize 3. Nuevos datos} (Lector);

\draw[thick, palette2, shorten <= 0.1cm, ->]  (3.6, -0.58) to[bend left] node[midway, above, sloped] {\scriptsize 4. Lectura} (Lector);
\end{tikzpicture}
